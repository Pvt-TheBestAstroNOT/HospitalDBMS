import mysql.connector
from mysql.connector import Error
from time import sleep
L=[]

def create_connection():
    try:
        connection = mysql.connector.connect(
            host='localhost',
            database='company',
            user='PythonBot',
            password='python2sql'
        )
        if connection.is_connected():
            return connection
    except Error as e:
        print(f"Error while connecting to MySQL: {e}")
        return None

def insert_employee(connection):
    
    while True:
        cursor = connection.cursor()
        emp_no = int(input("Enter Employee Number: "))
        e_name = input("Enter Employee Name: ")
        doj = input("Enter Date of Joining (YYYY-MM-DD): ")
        salary = float(input("Enter Salary: "))
        query = "INSERT INTO employee (EmpNo, EName, DOJ, Salary) VALUES (%s, %s, %s, %s)"
        cursor.execute(query, (emp_no, e_name, doj, salary))
        connection.commit()
        print("Employee data inserted successfully.")
        choice=input("Do You Wish To Continue?(Y/N): ")
        if choice.upper()=="N":
            break

def insert_department(connection):
    cursor = connection.cursor()
    dept_id = int(input("Enter Department ID: "))
    dept_name = input("Enter Department Name: ")
    dept_head_id = input("Enter Department Head ID: ")
    query = "INSERT INTO department (Deptid, DeptName, DeptHeadID) VALUES (%s, %s, %s)"
    cursor.execute(query, (dept_id, dept_name, dept_head_id))
    connection.commit()
    print("Department data inserted successfully.")

def remove_employee(connection):
    cursor = connection.cursor()
    emp_no = int(input("Enter Employee Number to remove: "))
    query = "DELETE FROM employee WHERE EmpNo = %s"
    cursor.execute(query, (emp_no,))
    connection.commit()
    print("Employee removed successfully.")

def remove_department(connection):
    cursor = connection.cursor()
    dept_id = int(input("Enter Department ID to remove: "))
    query = "DELETE FROM department WHERE Deptid = %s"
    cursor.execute(query, (dept_id,))
    connection.commit()
    print("Department removed successfully.")

def retrieve_employees(connection):
    cursor = connection.cursor()
    Emp_id = int(input("Enter the Employee ID of the employee you wish to retrieve data for: "))
    cursor.execute("SELECT * FROM employee WHERE EmpNo = %s", (Emp_id,))
    records = cursor.fetchall()
    print("Employee Records for Employee ID", Emp_id, "are:")
    for row in records:
        print(row)

def retrieve_departments(connection):
    cursor = connection.cursor()
    cursor.execute("SELECT * FROM department")
    records = cursor.fetchall()
    print("Department Records:")
    for row in records:
        print(row)

def Bulk_Detail_Change(connection):
   Cursor = connection.cursor()
   L=[]
   F_EmpNo=int(input("Enter the first Employee ID for the record you wish to change: "))
   a=-1
   while True:
       a+=1
       print('Enter the name to  be changed for Employee No. "',F_EmpNo+a,'": ')
       string=input()
       L.append(string)
       choice=input('Do you wish to continue?:(Y/N)')
       if choice.upper()=='Y':
           pass
       elif choice.upper()=='N':
           break
       else:
           print("Choose the right option...")
   for i in range(len(L)):
       query="Update employee\
           Set EName='{}'\
           where EmpNo={};".format(L[i],i+F_EmpNo)
       Cursor.execute(query)



def main():
    connection = create_connection()
    if connection is None:
        print("Failed to create connection to the database.")
        return
    
    while True:
        print("\nMenu:")
        print("1. Insert Employee")
        print("2. Insert Department")
        print("3. Remove Employee")
        print("4. Remove Department")
        print("5. Retrieve Employees")
        print("6. Retrieve Departments")
        print("7.Change Employee Details en masse")
        print("8. Exit")
        
        choice = int(input("Enter your choice: "))
        
        if choice == 1:
            insert_employee(connection)
        elif choice == 2:
            insert_department(connection)
        elif choice == 3:
            remove_employee(connection)
        elif choice == 4:
            remove_department(connection)
        elif choice == 5:
            retrieve_employees(connection)
        elif choice == 6:
            retrieve_departments(connection)
        elif choice == 7:
            Bulk_Detail_Change(connection)
        elif choice == 8:
            if connection.is_connected():
                connection.close()
                print("Connection to MySQL closed.")
            break
        else:
            print("Invalid choice. Please try again.")

if __name__ == "__main__":
    print('\n')
    print("Welcome to the Database Management Software(DMS) for Company",end=" ")
    for i in range(0,3):
        sleep(0.4)
        print(".",end=" ")
    print('\n')
    main()